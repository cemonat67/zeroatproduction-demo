<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Zero@Production — Dashboard</title>

  <!-- Main CSS (already standardized in your project) -->
  <link rel="stylesheet" href="assets/css/main.min.css" />

  <style>
    /* tiny safety net styles (keeps layout readable even if CSS breaks) */
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    .wrap { max-width: 1200px; margin: 0 auto; padding: 18px; }
    .topbar { display:flex; align-items:center; gap:14px; padding: 12px 0; }
    .topbar img { height: 42px; width:auto; }
    .grid { display:grid; grid-template-columns: repeat(12, 1fr); gap: 14px; }
    .card { border-radius: 14px; padding: 14px; border: 1px solid rgba(0,0,0,.08); background:#fff; }
    .span-12{ grid-column: span 12; }
    .span-6{ grid-column: span 6; }
    .span-4{ grid-column: span 4; }
    .btn { display:inline-flex; align-items:center; gap:10px; padding:10px 12px; border-radius: 12px; border:1px solid rgba(0,0,0,.12); background:#fff; cursor:pointer; }
    .btn:active{ transform: translateY(1px); }
    .muted{ opacity:.7; font-size: 12px; }
    @media (max-width: 900px) {
      .span-6,.span-4{ grid-column: span 12; }
    }
  



/* ZP_PILL_WHITE_V1 */
a.pill, a.pill:link, a.pill:visited{
  color:#fff !important;
  text-decoration:none !important;
  background:#02154e !important;
  border:1px solid rgba(2,21,78,.25) !important;
}
a.pill:hover{
  filter:brightness(1.06);
  text-decoration:none !important;
}

/* make top .btn buttons readable too */
.btn, .btn:link, .btn:visited{
  color:#fff !important;
  background:#02154e !important;
  border:1px solid rgba(2,21,78,.25) !important;
  opacity:1 !important;
}


/* ZP_TYPO_V1: +4px everywhere, thin */
html { font-size: 16px; } /* baseline; we will add via body below */
body{
  font-size: calc(14px + 4px) !important;   /* old base ~14 -> 18 */
  font-weight: 300 !important;
  -webkit-font-smoothing: antialiased;
  text-rendering: optimizeLegibility;
}

h1,h2,h3,h4,strong,b{
  font-weight: 300 !important; /* thin */
  letter-spacing: .2px;
}

/* unify clickable typography */
a, button, .btn, .pill{
  font-size: 14px !important;   /* was ~12-13 in places; now consistent */
  font-weight: 300 !important;
  letter-spacing: .15px;
}

/* keep KPI numbers readable (still not bold) */
#ceoScore, #cfoImpact, #ctoHealth{
  font-weight: 300 !important;
}


/* ZP_HEADER_2X_V1 */
.header, .topbar, .brandbar, header{
  padding-top: 18px !important;
  padding-bottom: 18px !important;
}

/* try to scale the logo safely */
.header img, .topbar img, .brandbar img, header img{
  height: 96px !important;    /* was ~48-64 => 2x */
  width: auto !important;
}

/* scale the title block near logo */
.header .title, .topbar .title, .brandbar .title, header .title{
  font-size: 24px !important;
  line-height: 1.15 !important;
  font-weight: 300 !important;
}


/* =========================
   UI PATCH (Typography + Pills)
   ========================= */

/* Global: +4px and thin */
:root { font-size: calc(100% + 4px); }
body { font-weight: 300; }
b, strong { font-weight: 500; }

/* Header sizing (fallback) */
#brandTitle { font-weight: 500 !important; }

/* Pills: unify typography + size */
a.pill, .pill {
  font-size: 14px !important;
  font-weight: 300 !important;
  line-height: 1 !important;
  padding: 6px 10px !important;
  border-radius: 999px !important;
}

/* Pill hover: our GREEN (no white hover) */
a.pill:hover, a.pill:focus, .pill:hover, .pill:focus {
  background: #005530 !important;
  border-color: #005530 !important;
  color: #ffffff !important;
}

/* If some pills are actually <a> with default link styles */
a.pill:visited { color: inherit; }

/* Optional: buttons hover also GREEN */
.btn:hover, .btn:focus {
  background: #005530 !important;
  border-color: #005530 !important;
  color: #ffffff !important;
}


/* =========================
   UI PATCH (Header 2x)
   ========================= */
#brandLogo { height: 96px !important; width: auto !important; }
#brandTitle { font-size: 28px !important; line-height: 1.1 !important; }


/* =========================
   UI PATCH (Hover Green Everywhere)
   ========================= */

/* Kill iOS/Safari tap highlight (often looks like white flash) */
a, button { -webkit-tap-highlight-color: rgba(0,0,0,0); }

/* Force all pill-like controls hover/active to GREEN */
a.pill, .pill,
a.btn, .btn,
#slotModules a, #slotExecutive3 a {
  background: transparent;
}

a.pill:hover, a.pill:focus, a.pill:active,
.pill:hover, .pill:focus, .pill:active,
a.btn:hover, a.btn:focus, a.btn:active,
.btn:hover, .btn:focus, .btn:active,
#slotModules a:hover, #slotModules a:focus, #slotModules a:active,
#slotExecutive3 a:hover, #slotExecutive3 a:focus, #slotExecutive3 a:active {
  background: #005530 !important;
  border-color: #005530 !important;
  color: #ffffff !important;
  text-decoration: none !important;
  filter: none !important;
  box-shadow: none !important;
  opacity: 1 !important;
}

/* If any rule sets hover background to white explicitly, nuke it */
a:hover { background-color: #005530 !important; color:#fff !important; }

/* Optional: keep visited from turning purple */
#slotModules a:visited, #slotExecutive3 a:visited { color: #ffffff !important; }


/* Brand: orange @ */
.at { color: #f9ba00 !important; font-weight: 400; }


    /* LIVE LOADER inputs (Phase 2) */
    .inp{
      height: 36px;
      padding: 0 12px;
      border-radius: 10px;
      border: 1px solid rgba(2,21,78,.10);
      background: #fff;
      min-width: 260px;
      font-size: 13px;
      font-weight: 300;
      outline: none;
    }
    .inp:focus{
      border-color: rgba(0,85,48,.45);
      box-shadow: 0 0 0 3px rgba(0,85,48,.10);
    }

/* === WW HEALTH CARD COLORS (v1) === */
#wwHealthCard.ww-ok .kpi-value{ color:#0a7a3a; }
#wwHealthCard.ww-monitor .kpi-value{ color:#b77900; }
#wwHealthCard.ww-critical .kpi-value{ color:#b00020; }
#wwHealthCard.ww-ok{ border-left:6px solid #0a7a3a; }
#wwHealthCard.ww-monitor{ border-left:6px solid #b77900; }
#wwHealthCard.ww-critical{ border-left:6px solid #b00020; }

/* === WW TIMELINE BUTTON (state glow) === */
#btnWWTimeline{ background:#005530 !important; color:#fff !important; border:1px solid rgba(0,0,0,.08) !important;  margin-top:10px !important; }
.role-ceo{ font-size:inherit; font-weight:inherit; margin-top:0; opacity:inherit; letter-spacing:inherit; }



.role-label{ font-size:13px; font-weight:800; padding:8px 0 10px 10px; margin-bottom:10px; border-bottom:1px solid rgba(0,0,0,.08); border-left:1px solid rgba(2,21,78,.22); display:block; opacity:.95; letter-spacing:.9px; text-transform:uppercase; }
.role-ceo,.role-cfo,.role-cto{ font-size:inherit; font-weight:inherit; margin-top:0; opacity:inherit; letter-spacing:inherit; }
/* ROLE_LABEL_LEFT_ACCENT_V1 */
.role-ceo{ border-left-color: rgba(0,85,48,.55) !important; }
.role-cfo{ border-left-color: rgba(249,186,0,.70) !important; }
.role-cto{ border-left-color: rgba(2,21,78,.55) !important; }
</style>
<style>
/* LIVE_BADGE_V1 */
.badge{
  font-size:11px;
  padding:4px 8px;
  border-radius:20px;
  margin-left:8px;
  font-weight:600;
}
.badge-live{ background:#005530; color:#fff; }
.badge-offline{ background:#f9ba00; color:#000; }
</style>
<style>
/* CTO_CARD_LAYOUT_V1 */
#cardCTO {
  display:flex !important;
  flex-direction:column !important;
}
#cardCTO .cto-actions {
  margin-top:auto !important;
  padding-top:10px !important;
}
</style>

<!-- CFO_SHOCK_STYLE_V1 -->
<style>
#cfoShockCard { border: 1px solid rgba(249,186,0,.20); }
#cfoShockCard .kpi-head { margin-bottom: 10px; }
#cfoShockCard .kpi-title { font-weight: 700; letter-spacing: .2px; }
#cfoShockCard .kpi-subtitle { opacity: .75; font-size: 12px; margin-top: 2px; }

.cfo-state { font-size: 12px; opacity: .85; margin-bottom: 10px; }
.cfo-table-wrap { overflow-x: auto; }
.cfo-table { width: 100%; border-collapse: collapse; font-size: 13px; }
.cfo-table th, .cfo-table td { padding: 8px 10px; border-bottom: 1px solid rgba(255,255,255,.08); text-align: left; }
.cfo-table th { opacity: .8; font-weight: 600; font-size: 12px; }

.badge { display:inline-flex; align-items:center; gap:6px; padding: 3px 8px; border-radius: 999px; font-size: 12px; font-weight: 700; letter-spacing: .2px; }
.badge::before { content:""; width:8px; height:8px; border-radius: 50%; display:inline-block; }

.badge.safe { background: rgba(0, 170, 90, .18); color: #9dffcc; border: 1px solid rgba(0, 170, 90, .25); }
.badge.safe::before { background: #00aa5a; }

.badge.pressure { background: rgba(249, 186, 0, .18); color: #ffe08a; border: 1px solid rgba(249, 186, 0, .28); }
.badge.pressure::before { background: #f9ba00; }

.badge.collapse { background: rgba(213, 22, 53, .18); color: #ffb3bf; border: 1px solid rgba(213, 22, 53, .28); }
.badge.collapse::before { background: #D51635; }

.mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size: 12px; opacity: .75; }
.cfo-foot { margin-top: 10px; display:flex; justify-content: space-between; align-items:center; }
</style>

</head>

<body>
<div id="zae-center">
<div id="zae-center">
<div id="zae-center">
  <div class="wrap">
    <div class="topbar">
      <img id="brandLogo" src="assets/img/plogo.svg" alt="Zero@Production" / onerror="this.onerror=null;this.src='assets/img/logo.png';">
      <div>
        <div style="" id="brandTitle">Zero@Production</div>
        <div class="muted">ML-Ready · Offline-first · iPad-safe</div>
      </div>
    </div>

    <div class="grid">
      <div class="card span-12">
        <div style="display:flex; gap:10px; flex-wrap:wrap">
          <button class="btn" id="btnPdf">Export PDF (simple)</button>
          <a class="btn" href="index.html">Refresh</a>
        </div>
        <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:12px;align-items:center">
          <input id="inpPassportId" class="inp" type="text" placeholder="Passport ID (e.g., EKOTEN-2401-B01)" />
          <input id="inpFacility" class="inp" type="text" placeholder="Facility (optional)" />
          <a href="#" class="btn" id="btnLoadLive">Load Live</a>
        </div>

        <div class="muted" style="margin-top:10px">
          This is the clean base. We will plug your existing modules/cards back in step-by-step.
        </div>
      </div>

      <!-- SLOT: Executive Cards -->
      
      <!-- EXECUTIVE CARDS (injected) -->
<div class="card span-4" id="slotExecutive1">
  <div class="role-label role-ceo">CEO</div>
<div class="kpi-card" id="wwHealthCard" style="margin-top:10px;">
    <div class="kpi-title">Wastewater Health</div>
    <div class="kpi-value" id="wwHealthStatus">--</div>
    <div class="kpi-sub" id="wwHealthMinutes">-- minutes in state</div>
    <button id="btnWWTimeline" class="btn" style="margin-top:6px;background:#005530;color:#fff;padding:6px 10px;border-radius:6px;">View Timeline</button>
  </div>

  <div style="font-size:18px;margin-top:10px; display:flex; align-items:center; gap:10px;">Decision Status <span id="ceoDecisionBadge" class="badge badge-live">LIVE</span></div>
  <div id="ceoDecision">--</div>
  <div id="ceoDecisionNote" style="margin-top:6px;font-size:12px;opacity:.65;">Based on Wastewater + System Health</div>
  <div id="ceoMeta" class="muted" style="margin-top:10px; font-size:12px; line-height:1.35;"></div>
</div>

<div class="card span-4" id="slotExecutive2">
  <div class="role-label role-cfo">CFO</div>
<div style="font-size:22px;margin-top:6px;">Impact / Year</div>
  <div id="cfoImpact" style="font-size:28px;margin-top:10px;">&euro; 477,440</div>
  <div class="muted">Estimated financial exposure</div>
</div>

<div class="card span-4" id="slotExecutive3">
  <div class="role-label role-cto">CTO</div>
<div style="font-size:22px;margin-top:14px;">System Health</div>
  <div id="ctoHealth" style="font-size:28px;margin-top:10px;">OK</div>
  <div id="ctoSub" class="muted" style="font-size:11px;opacity:.55;">Offline mode active</div>

  <div class="muted" style="margin-top:10px;">One-click executive snapshot. Demo-safe.</div>

  <div style="font-size:14px;opacity:.65;margin-top:6px;">Export / Copy / Email</div>
  <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:12px;">
    <a href="#" class="pill" id="btnExportPDF">Export PDF</a>
    <a href="#" class="pill" id="btnCopySummary">Copy Summary</a>
    <a href="#" class="pill" id="btnEmailSnapshot">Email Snapshot</a>
  </div>

</div>

  

</div>
<!-- /EXECUTIVE CARDS -->


      <!-- SLOT: Modules -->
      <div class="card span-12" id="slotModules">
        <div style="font-size:12px;opacity:.6;">Modules</div>
        <div style="margin-top:8px;display:flex;flex-wrap:wrap;gap:10px;">
          <a class="pill" href="fibre-dpp.html">Fibre DPP</a>
          <a class="pill" href="yarn-dpp.html">Yarn DPP</a>
          <a class="pill" href="fabric-dpp.html">Fabric DPP</a>
          <a class="pill" href="chemicals-dyes-management.dpp.html">Chemicals &amp; Dyes</a>
          <a class="pill" href="finishing-dpp.html">Finishing</a>
          <a class="pill" href="GarmentDPP.html">Garment</a>
          <a class="pill" href="wastewater-intelligence.html">Wastewater</a>
        </div>
        <div class="muted" style="margin-top:10px;">Open a module • Return back via “← Back”</div>
      </div>

      <!-- SLOT: Ingestion (Manual + CSV) -->
      <div class="card span-12" id="slotIngestion">
        <div style="font-size:12px;opacity:.6;">Ingestion</div>

        <div style="margin-top:10px;display:flex;flex-wrap:wrap;gap:10px;">
          <a href="#" class="pill" id="tabManual">Manual Entry</a>
          <a href="#" class="pill" id="tabCSV">CSV Upload</a>
        </div>

        <div id="paneManual" style="margin-top:12px;display:none;">
  <div class="muted" style="margin-bottom:8px;">Manual input opens as a popup. Evidence flow comes next.</div>
  <a href="#" class="btn" id="btnOpenWWModal">Open Manual Entry Form</a>

  <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:12px;">
    <input class="inp" id="inpPeriod" type="text" placeholder="Period (YYYY-MM)" />
    <input class="inp" id="inpProductionKg" type="number" placeholder="Production (kg)" />
    <input class="inp" id="inpEnergyKwh" type="number" placeholder="Energy (kWh)" />
  </div>

  <div class="muted" style="margin-top:10px;">Next: validate + write to cache + compute CO₂.</div>
</div>

<div id="paneCSV" style="margin-top:12px;display:none;">
          <div class="muted" style="margin-bottom:8px;">Upload two CSVs (energy.csv + production.csv). We only parse + preview counts for now.</div>
          <div style="display:flex;gap:10px;flex-wrap:wrap;">
            <input class="inp" id="csvEnergy" type="file" accept=".csv,text/csv" />
            <input class="inp" id="csvProduction" type="file" accept=".csv,text/csv" />
          </div>
          <div class="muted" id="csvStatus" style="margin-top:10px;">No files loaded.</div>
        </div>

      </div>


    </div>

  <!-- Vendor libs -->
  <script src="assets/libs/jspdf.umd.min.js"></script>

  <!-- Our clean wrapper -->
  <script src="assets/js/pdf-engine.js"></script>

  <script>
    (function(){
"use strict";

      var btn = document.getElementById("btnPdf");
      if (btn) {
        btn.addEventListener("click", function(){
          window.ZeroPDF.exportSimpleReport("Zero@Production Report", [
"Generated:" + new Date().toISOString(),
"Status: Base skeleton OK",
"Next: plug back executive cards + module tiles"
          ]);
        });
      }
    })();
  </script>
<script src="assets/libs/supabase.umd.js"></script>
<script src="assets/js/supabase.fabric.config.js?v=1771344458"></script>

<script>
/* ZERO_SUPABASE_CLIENT_V1 */
(function(){
  if (!window.supabase || !window.SUPABASE_URL || !window.SUPABASE_ANON_KEY) {
    return;
  }
  window.supabaseClient = window.supabase.createClient(
    window.SUPABASE_URL,
    window.SUPABASE_ANON_KEY,
    { db: { schema: window.SUPABASE_SCHEMA || "public" } }
  );
})();
</script>


<script src="assets/js/production-data.js?v=1771434637"></script>
  <script>
  (function(){
    var s=document.createElement("script");
    s.src="assets/js/manual-entry-wastewater.js?v="+Date.now();
    s.defer=true;
    document.head.appendChild(s);
  })();
  </script>
<script>
(function(){
  function ok(){
    return !!(window.ZeroProductionV1 && typeof window.ZeroProductionV1.boot === "function");
  }
  function ww(){
    // manual-entry-wastewater.js genelde global bind fonksiyonu veya init bırakır
    return !!(window.ManualEntryWastewater || window.manualEntryWastewater || window.ZP_WW || window.ZP_Wastewater);
  }
  var tries=0;
  (function loop(){
    tries++;
    // Boot için ZeroProduction yeterli; WW varsa daha iyi.
    if(ok() && (ww() || tries>50)){
      try{ window.ZeroProductionV1.boot(); }catch(e){ console.warn("boot failed", e); }
      return;
    }
    if(tries>80){
      console.warn("boot timeout");
      return;
    }
    setTimeout(loop, 80);
  })();
})();
</script>

</div>
    <div style="padding:16px;background:#fff;">
      <div class="muted" style="margin-bottom:10px;">
        Demo write → Supabase table <code>public.production_manual_entries</code>
      </div>

      <div style="display:flex;gap:10px;flex-wrap:wrap;">
        <input class="inp" id="mPassportId" type="text" placeholder="Passport ID (e.g., EKOTEN-2401-B01)" />
        <input class="inp" id="mFacility" type="text" placeholder="Facility (optional)" />
        <input class="inp" id="mPeriod" type="text" placeholder="Period (YYYY-MM)" />
      </div>

      <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:10px;">
        <input class="inp" id="mProductionKg" type="number" placeholder="Production (kg)" />
        <input class="inp" id="mEnergyKwh" type="number" placeholder="Energy (kWh)" />
        <input class="inp" id="mWaterM3" type="number" placeholder="Water (m³) (optional)" />
      </div>

      <div class="muted" style="margin-top:10px;font-size:12px;line-height:1.35;">
        Rules: period must be YYYY-MM · numbers must be non-negative · passport_id required.
      </div>

      <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:14px;align-items:center;justify-content:flex-end;">
        <a href="#" class="pill" id="btnManualCancel">Cancel</a>
        <a href="#" class="btn" id="btnManualSubmit">Save to Supabase</a>
      </div>

      <div id="manualStatus" class="muted" style="margin-top:10px;min-height:18px;"></div>
    </div>
  </div>
</div>
<!-- /Manual Entry Modal -->

<!-- === WW TIMELINE MODAL (v1) === -->
<div id="wwTimelineModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.45);z-index:100000;align-items:center;justify-content:center;">
  <div style="background:#fff;max-width:900px;width:92%;max-height:80vh;overflow:auto;border-radius:12px;padding:16px;box-shadow:0 10px 30px rgba(0,0,0,.25);">
    <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;">
      <div style="font-size:16px;font-weight:600;">Wastewater Timeline</div>
      <button id="btnWWTimelineClose" class="btn" style="padding:6px 10px;">Close</button>
    </div>
    <div style="margin-top:10px;font-size:12px;color:#555;" id="wwTimelineMeta">Loading…</div>
    <div style="margin-top:12px;">
      <table style="width:100%;border-collapse:collapse;font-size:12px;">
        <thead>
          <tr>
            <th style="text-align:left;border-bottom:1px solid #eee;padding:8px;">Started</th>
            <th style="text-align:left;border-bottom:1px solid #eee;padding:8px;">From → To</th>
            <th style="text-align:left;border-bottom:1px solid #eee;padding:8px;">Severity</th>
            <th style="text-align:right;border-bottom:1px solid #eee;padding:8px;">Minutes</th>
          </tr>
        </thead>
        <tbody id="wwTimelineBody">
          <tr><td colspan="4" style="padding:10px;color:#777;">Loading…</td></tr>
        </tbody>
      </table>
    </div>
  </div>
</div>


<!-- CFO_SHOCK_CARD_V1 -->
<div class="kpi-card" id="cfoShockCard">
  <div class="kpi-head">
    <div class="kpi-title">CFO Shock Engine</div>
    <div class="kpi-subtitle">Carbon price impact on margin (latest batch)</div>
  </div>

  <div id="cfoShockState" class="cfo-state">Loading…</div>

  <div class="cfo-table-wrap">
    <table class="cfo-table">
      <thead>
        <tr>
          <th>Price</th>
          <th>Margin After</th>
          <th>Break-even</th>
          <th>Shock</th>
        </tr>
      </thead>
      <tbody id="cfoShockRows"></tbody>
    </table>
  </div>

  <div class="cfo-foot">
    <span class="mono" id="cfoShockBatch">batch: —</span>
  </div>
</div>

</body>
</html>
