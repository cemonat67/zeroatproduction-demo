// assets/js/exec-bridge.js — Phase 2 (Executive listener)
(function(){
  const KEY = "ZERO_RISK_V1";

  function byId(id){ return document.getElementById(id); }

  function setDot(status){
    const dot = byId("execRiskDot");
    if(!dot) return;

    // hard reset
    dot.classList.remove("ok","monitor","action");
    dot.style.background = "";

    if(!status){
      dot.className = "risk-dot";
      dot.style.background = "#9CA3AF"; // OFFLINE/unknown
      dot.title = "CFO Shock: OFFLINE";
      return;
    }

    dot.className = "risk-dot " + String(status).toLowerCase();
    dot.title = "CFO Shock: " + status;
  }
      dot.className = "risk-dot " + String(status).toLowerCase();
      dot.title = "CFO Shock: " + status;
    }

  function setBanner(status){
    const host = byId("execRiskBanner");
    if(!host) return;
    if(status === "ACTION"){
      host.style.display = "block";
      host.textContent = "EXECUTIVE ALERT — CFO SHOCK CRITICAL";
    } else {
      host.style.display = "none";
      host.textContent = "";
    }
  }

  function apply(risk){
    if(!risk || !risk.cfoShock) return;
    const s = risk && risk.cfoShock ? risk.cfoShock.status : null;
      if(!s){ setDot(null); setBanner(null); return; }
      setDot(s);
      setBanner(s);
    if(s === "ACTION"){ window.__GAUGE_OVERRIDE__ = true; }
  }

  // Event bus (same page)
  window.addEventListener("zero:risk-update", function(e){
    apply(e && e.detail ? e.detail : null);
  });

  // Cross-page propagation (ops → exec)
  window.addEventListener("storage", function(e){
    if(!e || e.key !== KEY) return;
    try{
      apply(JSON.parse(e.newValue || "{}"));
    } catch(_e){}
  });

  // Initial paint
  try{
    const raw = localStorage.getItem(KEY);
    if(raw) apply(JSON.parse(raw));
  } catch(_e){}
})();

